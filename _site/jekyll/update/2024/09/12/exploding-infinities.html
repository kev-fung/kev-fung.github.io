<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Exploding Infinities [Regression] [Machine Learning] | kevfung</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Exploding Infinities [Regression] [Machine Learning]" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When working on large-scale machine learning (ML) platforms with simplified workflow interfaces for machine learning scientists, many model implementations can become black boxes. I once worked on a particular ML platform where several linear regression models had begun producing model weights to the order of 12 significant figures, which then were subjected to an np.exp() producing infinities, and the only thing changed had been the Databricks instance type it was running on!" />
<meta property="og:description" content="When working on large-scale machine learning (ML) platforms with simplified workflow interfaces for machine learning scientists, many model implementations can become black boxes. I once worked on a particular ML platform where several linear regression models had begun producing model weights to the order of 12 significant figures, which then were subjected to an np.exp() producing infinities, and the only thing changed had been the Databricks instance type it was running on!" />
<link rel="canonical" href="http://localhost:4000/jekyll/update/2024/09/12/exploding-infinities.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/update/2024/09/12/exploding-infinities.html" />
<meta property="og:site_name" content="kevfung" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-12T08:53:16+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Exploding Infinities [Regression] [Machine Learning]" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-09-12T08:53:16+01:00","datePublished":"2024-09-12T08:53:16+01:00","description":"When working on large-scale machine learning (ML) platforms with simplified workflow interfaces for machine learning scientists, many model implementations can become black boxes. I once worked on a particular ML platform where several linear regression models had begun producing model weights to the order of 12 significant figures, which then were subjected to an np.exp() producing infinities, and the only thing changed had been the Databricks instance type it was running on!","headline":"Exploding Infinities [Regression] [Machine Learning]","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/update/2024/09/12/exploding-infinities.html"},"url":"http://localhost:4000/jekyll/update/2024/09/12/exploding-infinities.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="kevfung" />

<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;450;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">
      <span class="medium">kky</span><span class="extralight">fung.co.uk</span>
    </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <a class="page-link" href="/index">about</a><a class="page-link" href="/notes/">notes</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">


  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Exploding Infinities [Regression] [Machine Learning]</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-09-12T08:53:16+01:00" itemprop="datePublished">
        Sep 12, 2024
      </time><!-- [Page views: <span id="page-views">Loading...</span>] -->
          
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>When working on large-scale machine learning (ML) platforms with simplified workflow interfaces for machine learning scientists, many model implementations can become black boxes. I once worked on a particular ML platform where several linear regression models had begun producing model weights to the order of 12 significant figures, which then were subjected to an np.exp() producing infinities, and the only thing changed had been the Databricks instance type it was running on!</p>

<h6 id="diving-into-the-cause">Diving into the cause</h6>

<p>Initially I thought it was a difference in how random seeds defaulted based on the internal implementation we used for regression. Fixing it did not work. I began injecting logs throughout the system, trying to understand the data at each step of the flow, perhaps the data IO step corrupted the model inputs or there was a division of zero happening due to numerical precision? Only at the modelling step I discovered the models had extremely high condition numbers!</p>

<p>The workflow was using an internal component that transformed the dataset to keep only a large group of one hot encoded features to predict the target labels. The result was a highly sparse, 300+ column dataset with a significant portion of duplicated rows corresponding to a different label each. The models were solved via OLS, the common implementation calculates the pseudo-inverse of the matrix, thus attempting to solve an extremely ill-conditioned matrix naturally produced numerical instability down to machine level precision in its calculations - hence our exploding infinities!</p>

<p>What might have worked on one machine type, wouldn‚Äôt necessarily always work on another, this becomes problematic when workflows aren‚Äôt properly containerised making models effectively dependent on the machine architecture. From an engineering perspective, this also reduces the number of infrastructure options available when designing cost efficient ML systems and pipelines.</p>

<h6 id="controlling-the-explosion">Controlling the explosion</h6>

<p>There were a number of ways to solve this practically. Containerising applications makes sense if not constrained by the scale and complexity of the platform and the initial motivation to change machine types in the first place. Since OLS was used, we could have used SGD as the replacement solver given it‚Äôs iterative nature. The trade-off would be an impact to the ‚Äúunderstood performance‚Äù of the model and convergence time, however this would solve the issue of exploding values.</p>

<p>Applying regularisation was another way. Introducing a bias term to the dataset could have stabilised the solver. There are many different regularisations that can be used like L1 and L2 biases. However, if one was only interested in attaining the most accurate model weights in the problem, the precision of these weights will be affected. This was the case our model was attempting to solve.</p>

<p>In the end, simply removing the infinities would not truly solve the nature of the problem that the model had set out to solve. Thus we turned to changing the methodology that would avoid our issue of numerical stability. Since we were dealing with an inverse optimisation problem, and given the non-linearity of the problem itself, non-convex solutions were finally investigated.</p>

<p><br /></p>

<p>// Kudos to John and Debs when we watched F1 in the pub üèéÔ∏è</p>

  </div>

  <!-- <div id="utterances-comments">
    <h6>Leave a comment below!</h6>
    <script src="https://utteranc.es/client.js"
    repo="kev-fung/kev-fung.github.io"
    issue-term="pathname"
    label="utterance‚ú®üí¨‚ú®"
    theme="github-dark"
    crossorigin="anonymous"
    async>
  </script>
  </div> --><a class="u-url" href="/jekyll/update/2024/09/12/exploding-infinities.html" hidden></a>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col-3">
        ¬© 2024 Kevin Fung  
        <!-- [Page views: <span id="page-views">Loading...</span>] -->

        <!-- <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p> -->
      <!--
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div> -->

    <!-- <div class="footer-social-icons"><ul class="social-media-list"></ul>

        <a href="https://www.linkedin.com/in/kevin-king-yue-fung/" target="_blank">
          <i class="fab fa-linkedin"></i>
        </a>
      
      
      
        <a href="mailto:your-email@example.com">
          <i class="fas fa-envelope"></i>
        </a>
      

      
    </div> -->

  </div>

</footer>
<!-- GoatCounter integration -->
    <!-- <script>
      var t = setInterval(function() {
          if (window.goatcounter && window.goatcounter.visit_count) {
              clearInterval(t);
              window.goatcounter.visit_count({append: 'body'});
          }
      }, 100);
    </script> -->
    <script data-goatcounter="https://kky.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>

    <!-- Fetch page views and display in #page-views -->

    <script>
      var r = new XMLHttpRequest();
      r.addEventListener('load', function() {
          document.querySelector('#page-views').innerText = JSON.parse(this.responseText).count
      })
      r.open('GET', 'https://kky.goatcounter.com/counter/' + encodeURIComponent(location.pathname) + '.json')
      r.send()
    </script>
  
    <!-- <script>
      fetch('https://kky.goatcounter.com/counter/' + encodeURIComponent(window.location.pathname))
        .then(response => response.json())
        .then(data => {
            document.getElementById('page-views').innerText = data.count;
        })
        .catch(error => {
            console.error('Error fetching page views:', error);
            document.getElementById('page-views').innerText = 'Unavailable';
        });
    </script> -->

  </body>

</html>
